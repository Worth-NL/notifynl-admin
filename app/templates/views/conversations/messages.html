<div class="ajax-block-container">
  {% for message in conversation %}
  
  {% if message.status == 'delivered' %}
    {% set status_text_in_heading = 'sent' %}
    {% set visual_status_text %}
      <div class="sms-message-status sms-message-status-outbound" tabindex="-1">
        {{ message.created_at | format_datetime_relative }}
      </div>
    {% endset %}
  {% elif message.status in ['pending', 'sending', 'created'] %}
    {% set status_text_in_heading = 'in sending' %}
    {% set visual_status_text %}
      <div class="sms-message-status sms-message-status-outbound hint" tabindex="-1">
        sending
      </div>
    {% endset %}
  {% else %}
    {% set status_text_in_heading = 'failed to send' %}
    {% set visual_status_text %}
      <div class="sms-message-status sms-message-status-outbound table-field-error-label" tabindex="-1">
        Failed (sent {{ message.created_at | format_datetime_relative }})
      </div>
    {% endset %}
  {% endif %}
  
    <div class="govuk-grid-row sms-message-row" id="n{{ message.id }}" tabindex="0">
      {% if message.inbound %}
        <div class="govuk-grid-column-two-thirds sms-message-inbound">
          <h2 class="govuk-visually-hidden">{{ message.created_at | format_datetime_relative }} message received</h2>
          {{ message.content | string }}
          <div class="sms-message-status">
            {{ message.created_at | format_datetime_relative }}
          </div>
        </div>
      {% else %}
        <div class="govuk-grid-column-one-third">
          &nbsp;
        </div>
        <div class="govuk-grid-column-two-thirds">
          <h2 class="govuk-visually-hidden">{{ message.created_at | format_datetime_relative }} message {{ status_text_in_heading }}</h2>
          {{ message.content | string }}
          {{ visual_status_text }}
        </div>
      {% endif %}
    </div>
  {% endfor %}
</div>
